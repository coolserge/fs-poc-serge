<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <!-- LightningFS and Isomorphic-git scripts-->
    <script src="https://cdn.jsdelivr.net/npm/@isomorphic-git/lightning-fs/dist/lightning-fs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/isomorphic-git@1.25.3/index.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/isomorphic-git@1.25.3/http/web/index.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/idb-keyval/dist/umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/openpgp@5.11.1/dist/openpgp.min.js"></script>
    <script src="app.js"></script>
    <title>LightningFS and Isomorphic-git POC</title>
</head>

<body>
    <div class="container mt-5">
        <h1 class="mb-3">LightningFS and Isomorphic-git POC</h1>
        <div id="staticDisplay" class="mt-3">
            <p>Navigate to the static page <a href="admin/index.html">here</a></p>
        </div>
        <!-- Bootstrap styled buttons -->
        <button id="cloneBtn" class="btn btn-primary mr-2" style="display: none;">Clone Repo</button>
        <button id="deleteBtn" class="btn btn-danger" style="display: none;">Delete Repo</button>
        <!-- Div to display content -->
        <div id="contentDisplay" class="mt-3"></div>
    </div>
    <script>

        // Register the service worker
                registerServiceWorker(); 

        // Example URL and path variables (these could come from user input or another part of your application)
        const repoUrl = 'https://github.com/coolserge/foo';
        const directoryPath = '/foo';
        const contentDisplayId = 'contentDisplay'; // Correctly assigning the ID as a string
        const corsProxy = 'https://sandstonemountain.com'; // CORS Proxy URL
        const armoredPublicKey = `-----BEGIN PGP PUBLIC KEY BLOCK-----

mQENBGX19UcBCACobhXY5SVtc+fM8j/XrMhEfikazwbjHcb0ErNwA1SaFhqlvntt
6HJ5zbPu0JmtYqgI1h4gCsYPtr0ZQfcPO3xpG35WFe4DAcvqoZYUmRD/RuNabjvq
soXt5wJoo7SUh7deXWWv1/EcKQ5YbJWkQ9+8PnuTnfty1ZNyDE/7ygxq1Eml9XhQ
799sLks17OnFdY4ZtD1HvFrwN9Ri9K2sJG4zuEURcfG0CRnePr3hAPREgQS6y0eT
6ioFb01SM3iJzIqhGaKPV/Q2pHI1WE+Fd4oMcKH1PpABLoIcEyDJyneAb4rcedoN
p0pvhMesqpFX3jhczW/PXS1ZbiyiUTUPLDgvABEBAAG0MlNlcmdlIFNpbW9ub3Yg
KE15IDIwNDggUEdQIGtleSkgPHNlcmdlZUBnbWFpbC5jb20+iQFOBBMBCgA4FiEE
cIaaxqRAv96GV4a+J2bfNv9VIjEFAmX19UcCGwMFCwkIBwIGFQoJCAsCBBYCAwEC
HgECF4AACgkQJ2bfNv9VIjEuVgf9EGatR5AP7ySFdPcTDDtYtg5RaDHZe3g8gRUe
hgZ8VN74JrQbO82gPZZpvjIjXJe8aIr6QdPb5z9rQNsvhTW4TJGyxvWp475hEMQC
Ve9s9QXj/A+iX2e4KLf+A0MANStC+QnMIV+ZqcIjB9OvmvyIfMyfha4RHtTuMKlP
uwyXMbZdeVSExyQr4v07astdGQVuQQHKXrJG0T4x03YiNv7n9m+drepviebjZ9u7
ZJvf0u1XfZoXj7+eX5rMfP+xq9Y42lflBc+ervgIFS0d9M7aOQrYU6LEif2eO6tt
BMrN91PE9DdpirOrFjLy5z/U4vyaMSp0VIc/ftu79gu3q6zQ2bkBDQRl9fVHAQgA
13T7ChjYeQVMtUfOzbgHQzPBbpdFgmy6fizKEc8lV47c+VTpuXGjdh3NCbIAyuOJ
r0mqnWd/A6aD+CxXtlT/4RT5/MP1P8FGPQ1E1goBjjzlwl7JK2VAGJbZ2CpyysVI
SpyjDD/D/J7hQ5Ps6kNYRIoLjFceablClmgVLKIlppx/jtZnQiGTFvFq0y2Phseq
9FkTD4G10Cq6ps1FZz1j5uqWef3ESSaCUo2cJ5Q+q6lURf8g+StWM75XHmbjqxx8
wL83Pn5T/IKUXOhgAs/DBADQh9lJZjLZXy+//q/+MAVws9e7O22S6H7wCN1BWa1P
fvfwR9j3lBEDUS0wyedS7QARAQABiQE2BBgBCgAgFiEEcIaaxqRAv96GV4a+J2bf
Nv9VIjEFAmX19UcCGwwACgkQJ2bfNv9VIjEYZwf+Jz5go04WvNjyvCb1Ni/bZ5cE
72cPiLY+I5m60t1JhG/FBH/vgKyjYWXe1YUs9ZFI6+MeQIaIZAgU4p1E9o0iX1N2
woTsohkGualR0c3bGb+9ve77LWC/6EbqdbMEMpoPHCSJ8W7ZCGRQ2du6G3Gt6PNu
4yzc09JtI0Uwe7aaN4Bslx1cwoI0d2vigOMfqtL0eGIRP633uqklmcrVWKH73Ypc
GosoXUVVq4/BAkFgKUaBGQ/Y57CHWTmEeguJrr0F5LrFM3VOs1UuCTKNtCOtDMvJ
6Dd5ss1xcYlKxzd3DfSIVOvilqk3KAnZIDz7k8T7ImSaElOeDJXs36u/723qpg==
=Q0Tf
-----END PGP PUBLIC KEY BLOCK-----`;

        // Instantiate a new filesystem
        const fs = new LightningFS('testfs');
        const pfs = fs.promises; // Use promises interface for cleaner async operations

        // Attach the event listener to the buttons
        document.getElementById('cloneBtn').addEventListener('click', () => cloneRepo(repoUrl, directoryPath, contentDisplayId, corsProxy, armoredPublicKey));
        document.getElementById('deleteBtn').addEventListener('click', () => deleteRepo(directoryPath, contentDisplayId));

        // Initial call also needs to pass the necessary arguments
        checkAndDisplayContent(directoryPath, contentDisplayId);
    </script>
</body>

</html>